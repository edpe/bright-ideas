import Head from "next/head";

import { ApolloClient, InMemoryCache, gql } from "@apollo/client";
import styles from "../styles/global.module.scss";
import Header from "../src/components/Header";
import Layout from "../src/components/Layout";
import Bookshelf from "../src/components/Bookshelf";
import Hero from "../src/components/Hero";

export default function Home({ books }) {
  return (
    <>
      <Head>
        {/* generate from cms */}

        <title>Bright Ideas</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout>
        <Header />

        <main>
          <Hero image={`/images/heroImage.png`} width={1024} height={600}>
            Bright Ideas
          </Hero>

          <div className={styles.text}>
            <p>
              Bright Ideas is an archive for the poems of Pat Perkins. It
              features previous poetry collections Bright Ideas (2001), More
              Bright Ideas (2004) and a new, previously unpublished collection,
              Bright Ideas in Action written in 2013.
            </p>
            <p>
              This site has been designed and written by her son, Ed Perkins
              with help from her daughter Sara Perkins who did a lot of the
              typing.
            </p>
            <p>
              {
                "We hope that whoever reads these poems enjoys them and finds the ideas in them helpful, as that's what Pat would have wished for them."
              }
            </p>

            <div className="bookShelfPosition">
              <Bookshelf books={books} link="[slug]" />
            </div>
          </div>
        </main>
      </Layout>

      <style jsx global>{`
        html {
          margin: 0;
        }

        body {
          padding: 0;
          margin: 0;
          font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,
            Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue,
            sans-serif;
        }
      `}</style>
    </>
  );
}

export async function getStaticProps() {
  const client = new ApolloClient({
    uri: "https://larkin-cms.herokuapp.com/graphql",
    cache: new InMemoryCache(),
  });

  const { data } = await client.query({
    query: gql`
      query getBooks {
        books {
          id
          title
          slug
          poems {
            id
            title
            slug
          }
        }
      }
    `,
  });

  return {
    props: {
      books: data.books,
    },
  };
}
